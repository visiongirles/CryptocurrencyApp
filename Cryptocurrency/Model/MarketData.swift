//
//  MarketDataModel.swift
//  MoonCut
//
//  Created by Kate Sychenko on 12.05.2022.
//

import Foundation

//JSON data:
/*
 
 URL: https://api.coingecko.com/api/v3/global
 JSON Response:
 {
 "data": {
 "active_cryptocurrencies": 12354,
 "upcoming_icos": 0,
 "ongoing_icos": 49,
 "ended_icos": 3376,
 "markets": 728,
 "total_market_cap": {
 "btc": 48670205.942859314,
 "eth": 650646845.0518686,
 "ltc": 16376073362.156723,
 "bch": 6429754095.597022,
 "bnb": 4880490017.723248,
 "eos": 773977719744.8212,
 "xrp": 2987694130924.5703,
 "xlm": 9239090168362.684,
 "link": 111724474444.76414,
 "dot": 95345799051.06451,
 "yfi": 76534732.61138001,
 "usd": 1846687139137.833,
 "aed": 6782881862053.2295,
 "ars": 194401536285699.22,
 "aud": 2601749496465.6714,
 "bdt": 158617697884176.78,
 "bhd": 696178891209.2933,
 "bmd": 1846687139137.833,
 "brl": 9757894843204.283,
 "cad": 2349085762088.836,
 "chf": 1702695402837.8367,
 "clp": 1511790426455187.2,
 "cny": 11746776892055.76,
 "czk": 39206091307465.7,
 "dkk": 11979806648769.291,
 "eur": 1609903067470.4392,
 "gbp": 1361933611801.2905,
 "hkd": 14381971739298.336,
 "huf": 569925598711958.5,
 "idr": 26565610174424240,
 "ils": 5906181916244.678,
 "inr": 137943832225943.36,
 "jpy": 212256582665886.44,
 "krw": 2214321044246722,
 "kwd": 558286762529.8696,
 "lkr": 374054359846390.25,
 "mmk": 3280243122921854,
 "mxn": 38055210028735.09,
 "myr": 7718228898026.582,
 "ngn": 768295717366902.5,
 "nok": 16122415273947.291,
 "nzd": 2782119122719.5454,
 "php": 94516217811782.7,
 "pkr": 325755611343913.4,
 "pln": 7319252141615.849,
 "rub": 140104367537752.02,
 "sar": 6928467289354.322,
 "sek": 16835049994253.44,
 "sgd": 2482981659799.16,
 "thb": 60906362297816.32,
 "try": 25077209887273.35,
 "twd": 51336423271633.3,
 "uah": 52159648697953.82,
 "vef": 184908783241.8711,
 "vnd": 41827463701471880,
 "zar": 28361393382571.72,
 "xdr": 1306507144007.2078,
 "xag": 81706395468.08269,
 "xau": 1018614159.077038,
 "bits": 48670205942859.31,
 "sats": 4867020594285931
 },
 "total_volume": {
 "btc": 2038792.5124039284,
 "eth": 27255564.060451895,
 "ltc": 685992900.7191927,
 "bch": 269342080.082671,
 "bnb": 204443484.71996018,
 "eos": 32421888282.8607,
 "xrp": 125154358924.09377,
 "xlm": 387025028798.8809,
 "link": 4680132691.80893,
 "dot": 3994030792.1174936,
 "yfi": 3206036.152181345,
 "usd": 77357632643.82143,
 "aed": 284134584700.7548,
 "ars": 8143470710693.678,
 "aud": 108987157333.43112,
 "bdt": 6644487495300.074,
 "bhd": 29162899215.128952,
 "bmd": 77357632643.82143,
 "brl": 408757730889.95135,
 "cad": 98403086035.10359,
 "chf": 71325825953.68466,
 "clp": 63328825963864.42,
 "cny": 492071901247.3483,
 "czk": 1642341219844.6482,
 "dkk": 501833506195.40717,
 "eur": 67438759628.59793,
 "gbp": 57051331432.450935,
 "hkd": 602460082665.5908,
 "huf": 23874155055876.54,
 "idr": 1112832092279324.9,
 "ils": 247409667464.16266,
 "inr": 5778460288512.899,
 "jpy": 8891417717765.904,
 "krw": 92757798690412.55,
 "kwd": 23386604785.614735,
 "lkr": 15669118577024.5,
 "mmk": 137409221685423.14,
 "mxn": 1594130860174.1633,
 "myr": 323316225634.85205,
 "ngn": 32183869485135.402,
 "nok": 675367175988.1478,
 "nzd": 116542832029.01859,
 "php": 3959279675159.734,
 "pkr": 13645886398370.084,
 "pln": 306603109102.15424,
 "rub": 5868965005539.807,
 "sar": 290233151027.8641,
 "sek": 705219409067.7659,
 "sgd": 104011978547.57635,
 "thb": 2551364495073.9585,
 "try": 1050483078090.5261,
 "twd": 2150480224034.4875,
 "uah": 2184965096302.612,
 "vef": 7745819756.625834,
 "vnd": 1752150379382553.8,
 "zar": 1188057361779.3186,
 "xdr": 54729519446.27929,
 "xag": 3422676852.6809883,
 "xau": 42669696.590005495,
 "bits": 2038792512403.9285,
 "sats": 203879251240392.84
 },
 "market_cap_percentage": {
 "btc": 38.932508091964685,
 "eth": 18.357010685562674,
 "usdt": 4.223899297976172,
 "bnb": 3.445796799739604,
 "usdc": 2.754278230181137,
 "ada": 1.8478291562416527,
 "sol": 1.8049820970860169,
 "xrp": 1.600973667068508,
 "dot": 1.1327620204596278,
 "luna": 1.1043767583027004
 },
 "market_cap_change_percentage_24h_usd": 3.7000335239235573,
 "updated_at": 1643971856
 }
 }
 */

struct GlobalData: Codable {
    let data: MarketData?
}

struct MarketData: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
            case totalMarketCap = "total_market_cap"
            case totalVolume = "total_volume"
            case marketCapPercentage = "market_cap_percentage"
            case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
        }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
            return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: {  $0.key == "btc" }) {
            return item.value.asPercentString()
        }
        return ""
    }
}
